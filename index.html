<!-- DepositAccountDownloadTransactionsSteps -->

import io.cucumber.java.en.Given;
import io.cucumber.java.en.When;
import io.cucumber.java.en.Then;
import static io.restassured.RestAssured.*;
import static org.hamcrest.Matchers.*;
import io.restassured.response.Response;

public class DepositAccountDownloadTransactionsSteps {

    private Response response;
    private final String BASE_URL = "https://localhost:8443/private/1608745/small-business/accounts";

    @Given("I am a small business retail deposit account holder")
    public void i_am_a_small_business_retail_deposit_account_holder() {
        // Setup code if needed
    }

    @When("I download my transactions as CSV")
    public void i_download_my_transactions_as_CSV() {
        response = given()
            .header("Client-Correlation-Id", "SbbTest123")
            .header("profileReferenceld", "rd5GDeD6/...") // Add valid reference ID
        .when()
            .get(BASE_URL + "/jg5mFCxvS9%2BsoKzXLPBNRF%2BzfK0mWfGNu16UZUvhk6E%3D/transactions");
    }

    @Then("I receive a CSV file")
    public void i_receive_a_CSV_file() {
        response.then()
            .statusCode(200)
            .header("Content-Type", containsString("text/csv"));
    }

    @When("I download my transactions as QFX")
    public void i_download_my_transactions_as_QFX() {
        response = given()
            .header("Client-Correlation-Id", "SbbTest123")
            .header("profileReferenceld", "rd5GDeD6/...")
        .when()
            .get(BASE_URL + "/jg5mFCxvS9%2BsoKzXLPBNRF%2BzfK0mWfGNu16UZUvhk6E%3D/transactions");
    }

    @Then("I receive a QFX file")
    public void i_receive_a_QFX_file() {
        response.then()
            .statusCode(200)
            .header("Content-Type", containsString("application/x-qfx"));
    }

    @When("I download my transactions as 000")
    public void i_download_my_transactions_as_000() {
        response = given()
            .header("Client-Correlation-Id", "SbbTest123")
            .header("profileReferenceld", "rd5GDeD6/...")
        .when()
            .get(BASE_URL + "/jg5mFCxvS9%2BsoKzXLPBNRF%2BzfK0mWfGNu16UZUvhk6E%3D/transactions");
    }

    @Then("I receive a 000 file")
    public void i_receive_a_000_file() {
        response.then()
            .statusCode(200)
            .header("Content-Type", containsString("application/octet-stream"));
    }

    @When("I download my transactions with a mismatched accountReferenceId")
    public void i_download_my_transactions_with_mismatched_accountReferenceId() {
        response = given()
            .header("Client-Correlation-Id", "SbbTest123")
            .header("profileReferenceld", "invalid_reference_id")
        .when()
            .get(BASE_URL + "/invalid_account/transactions");
    }

    @Then("I receive a 403 unauthorized error")
    public void i_receive_a_403_unauthorized_error() {
        response.then()
            .statusCode(403);
    }
}



<!-- DepositRecentTransactions -->

import io.cucumber.java.en.Given;
import io.cucumber.java.en.When;
import io.cucumber.java.en.Then;
import static io.restassured.RestAssured.*;
import static org.hamcrest.Matchers.*;
import io.restassured.response.Response;

public class DepositRecentTransactions {
    
    private Response response;
    private String baseUrl = "https://localhost:8443/private/1608745/small-business/accounts";
    private String accountId = "jg5mFCxvS9%2BsoKzXLPBNRF%2BzfK0mWfGNu16UZUvhk6E%3D";
    
    @Given("I have a small business retail deposit account")
    public void i_have_a_small_business_retail_deposit_account() {
        // Assume account exists and is valid
        System.out.println("Verified small business retail deposit account");
    }
    
    @When("I apply filters to view my recent transactions")
    public void i_apply_filters_to_view_my_recent_transactions() {
        response = given()
            .header("Client-Correlation-Id", "SbbTest123")
            .header("profileReferenceld", "your_profile_reference")
        .when()
            .get(baseUrl + "/" + accountId + "/transactions");
    }
    
    @Then("I should see only the posted transactions that match the applied filters")
    public void i_should_see_only_the_posted_transactions_that_match_the_applied_filters() {
        response.then()
            .statusCode(200)
            .body("transactions", not(empty()))
            .body("transactions.status", everyItem(equalTo("POSTED")));
    }
}


<!-- DepositAccountSearchTransactions -->

import io.cucumber.java.en.Given;
import io.cucumber.java.en.When;
import io.cucumber.java.en.Then;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import static io.restassured.RestAssured.given;
import io.restassured.response.Response;

public class DepositAccountSearchTransactions {
    private static final Logger logger = LoggerFactory.getLogger(DepositAccountSearchTransactions.class);
    private Response response;

    @Given("I am logged in as a small business retail deposit account holder")
    public void iAmLoggedIn() {
        logger.info("User is logged in as a small business retail deposit account holder");
    }

    @When("I enter a transaction description in the search field")
    public void iEnterTransactionDescription() {
        response = given()
                .header("Client-Correlation-Id", "SbbTest123")
                .header("profileReferenceld", "yourProfileReferenceId")
                .when()
                .get("https://localhost:8443/private/1608745/small-business/accounts/transactions/search?searchText=stop");

        logger.info("Sent API request to search transactions by description");
    }

    @Then("I should see a list of transactions matching the entered description")
    public void iShouldSeeMatchingTransactions() {
        logger.info("Response: {}", response.getBody().asString());
        response.then().statusCode(200);
    }

    @When("I specify a date or date range in the transaction search")
    public void iSpecifyDateRange() {
        response = given()
                .header("Client-Correlation-Id", "SbbTest123")
                .header("profileReferenceld", "yourProfileReferenceId")
                .when()
                .get("https://localhost:8443/private/1608745/small-business/accounts/transactions?startDate=2024-08-02&endDate=2024-10-31");

        logger.info("Sent API request to search transactions by date range");
    }

    @Then("I should see all transactions that occurred on the specified date or within the date range")
    public void iShouldSeeTransactionsByDate() {
        logger.info("Response: {}", response.getBody().asString());
        response.then().statusCode(200);
    }

    @When("I input a specific transaction amount in the search criteria")
    public void iInputTransactionAmount() {
        response = given()
                .header("Client-Correlation-Id", "SbbTest123")
                .header("profileReferenceld", "yourProfileReferenceId")
                .when()
                .get("https://localhost:8443/private/1608745/small-business/accounts/transactions?amount=100.00");

        logger.info("Sent API request to search transactions by amount");
    }

    @Then("I should see all transactions that match the specified amount")
    public void iShouldSeeTransactionsByAmount() {
        logger.info("Response: {}", response.getBody().asString());
        response.then().statusCode(200);
    }
}

<!-- DepositTransactions -->

import io.cucumber.java.en.Given;
import io.cucumber.java.en.When;
import io.cucumber.java.en.Then;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import static io.restassured.RestAssured.given;
import io.restassured.response.Response;

public class DepositTransactions {
    private static final Logger logger = LoggerFactory.getLogger(DepositTransactions.class);
    private Response response;
    private String accountType;
    private String accountReferenceId;

    @Given("my account type is a small business retail deposit account")
    public void myRetailDepositAccount() {
        accountType = "retail-deposit";
        logger.info("Account type set to small business retail deposit account");
    }

    @When("I request a list of recent transactions for my retail deposit account")
    public void requestRetailDepositTransactions() {
        response = given()
                .header("Client-Correlation-Id", "SbbTest123")
                .header("profileReferenceld", "yourProfileReferenceId")
                .when()
                .get("https://localhost:8443/private/1608745/small-business/accounts/recent-transactions?accountType=" + accountType);
        
        logger.info("Fetching recent transactions for retail deposit account");
    }

    @Then("I should receive the posted transactions for my retail deposit account")
    public void validateRetailDepositTransactions() {
        logger.info("Response: {}", response.getBody().asString());
        response.then().statusCode(200);
    }

    @Given("I am a verified holder of a money market deposit account")
    public void verifiedMoneyMarketHolder() {
        accountType = "money-market";
        logger.info("Verified as a money market deposit account holder");
    }

    @When("I review my recent transactions for my money market account")
    public void requestMoneyMarketTransactions() {
        response = given()
                .header("Client-Correlation-Id", "SbbTest123")
                .header("profileReferenceld", "yourProfileReferenceId")
                .when()
                .get("https://localhost:8443/private/1608745/small-business/accounts/recent-transactions?accountType=" + accountType);
        
        logger.info("Fetching recent transactions for money market account");
    }

    @Then("I should be able to see my posted money market transactions")
    public void validateMoneyMarketTransactions() {
        logger.info("Response: {}", response.getBody().asString());
        response.then().statusCode(200);
    }

    @Given("My profile deposit account is registered under small business banking")
    public void profileDepositAccount() {
        accountType = "profile-deposit";
        logger.info("Profile deposit account set under small business banking");
    }

    @When("I apply filters to view my recent profile deposit transactions")
    public void requestProfileDepositTransactions() {
        response = given()
                .header("Client-Correlation-Id", "SbbTest123")
                .header("profileReferenceld", "yourProfileReferenceId")
                .when()
                .get("https://localhost:8443/private/1608745/small-business/accounts/recent-transactions?accountType=" + accountType);
        
        logger.info("Fetching recent transactions for profile deposit account");
    }

    @Then("I should get my filtered posted transactions for my profile deposit account")
    public void validateProfileDepositTransactions() {
        logger.info("Response: {}", response.getBody().asString());
        response.then().statusCode(200);
    }

    @Given("My small business profile savings account is active")
    public void profileSavingsAccountActive() {
        accountType = "profile-savings";
        logger.info("Small business profile savings account is active");
    }

    @When("I retrieve the latest transactions from my profile savings account")
    public void requestProfileSavingsTransactions() {
        response = given()
                .header("Client-Correlation-Id", "SbbTest123")
                .header("profileReferenceld", "yourProfileReferenceId")
                .when()
                .get("https://localhost:8443/private/1608745/small-business/accounts/recent-transactions?accountType=" + accountType);
        
        logger.info("Fetching recent transactions for profile savings account");
    }

    @Then("I should successfully view my posted transactions for my profile savings account")
    public void validateProfileSavingsTransactions() {
        logger.info("Response: {}", response.getBody().asString());
        response.then().statusCode(200);
    }

    @Given("I have an active small business retail CD account")
    public void activeRetailCDAccount() {
        accountType = "retail-cd";
        logger.info("Small business retail CD account is active");
    }

    @When("I fetch my latest transactions for my retail CD account")
    public void requestRetailCDTransactions() {
        response = given()
                .header("Client-Correlation-Id", "SbbTest123")
                .header("profileReferenceld", "yourProfileReferenceId")
                .when()
                .get("https://localhost:8443/private/1608745/small-business/accounts/recent-transactions?accountType=" + accountType);
        
        logger.info("Fetching recent transactions for retail CD account");
    }

    @Then("I should be presented with my posted transactions for my retail CD account")
    public void validateRetailCDTransactions() {
        logger.info("Response: {}", response.getBody().asString());
        response.then().statusCode(200);
    }

    @Given("My accountReferenceId does not match any existing small business accounts")
    public void invalidAccountReference() {
        accountReferenceId = "invalidReference";
        logger.info("Using an invalid accountReferenceId");
    }

    @When("I attempt to access my recent transactions with an invalid reference")
    public void requestTransactionsWithInvalidReference() {
        response = given()
                .header("Client-Correlation-Id", "SbbTest123")
                .header("profileReferenceld", accountReferenceId)
                .when()
                .get("https://localhost:8443/private/1608745/small-business/accounts/recent-transactions");
        
        logger.info("Attempting to fetch transactions with an invalid reference ID");
    }

    @Then("I should receive an error indicating no transactions are available")
    public void validateErrorForInvalidReference() {
        logger.info("Response: {}", response.getBody().asString());
        response.then().statusCode(404); // Assuming 404 is returned for no transactions found
    }
}


<!-- LoanAccountTransactions -->


import io.cucumber.java.en.Given;
import io.cucumber.java.en.When;
import io.cucumber.java.en.Then;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import static io.restassured.RestAssured.given;
import io.restassured.response.Response;

public class LoanAccountTransactions {
    private static final Logger logger = LoggerFactory.getLogger(LoanAccountTransactions.class);
    private Response response;
    private String accountType;

    @Given("I hold a small business retail ILA account")
    public void iHoldRetailILAAccount() {
        accountType = "retail-ila";
        logger.info("User holds a small business retail ILA account");
    }

    @When("I search for my recent loan account transactions")
    public void searchRecentLoanTransactions() {
        response = given()
                .header("Client-Correlation-Id", "LoanTest123")
                .header("profileReferenceId", "yourProfileReferenceId")
                .when()
                .get("https://localhost:8443/private/loan/accounts/recent-transactions?accountType=" + accountType);
        
        logger.info("Fetching recent transactions for retail ILA loan account");
    }

    @Then("I should be able to view my posted loan transactions")
    public void validateLoanTransactions() {
        logger.info("Response: {}", response.getBody().asString());
        response.then().statusCode(200);
    }

    @Given("I hold a small business retail LOC account")
    public void iHoldRetailLOCAccount() {
        accountType = "retail-loc";
        logger.info("User holds a small business retail LOC account");
    }

    @When("I retrieve my recent loan account transactions")
    public void retrieveRecentLoanTransactions() {
        response = given()
                .header("Client-Correlation-Id", "LoanTest123")
                .header("profileReferenceId", "yourProfileReferenceId")
                .when()
                .get("https://localhost:8443/private/loan/accounts/recent-transactions?accountType=" + accountType);
        
        logger.info("Fetching recent transactions for retail LOC loan account");
    }

    @Then("I should be able to see only the posted Loan transactions")
    public void validateLOCTransactions() {
        logger.info("Response: {}", response.getBody().asString());
        response.then().statusCode(200);
    }
}
